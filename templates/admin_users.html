<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Secure Send</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body {
    background-color: #f5f6f8;
  }
</style>
</head>

<body>

<div class="container mt-5">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="mb-0">ユーザー管理</h3>

    <!-- Back button -->
    <a href="{{ url_for('menu') }}"
        class="btn btn-outline-secondary"
        aria-label="メニューに戻る">
        <svg width="20" height="20"
            fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round"
            viewBox="0 0 24 24">
            <path d="M9 14l-4-4 4-4"/>
            <path d="M5 10h7a5 5 0 1 1 0 10"/>
        </svg>
    </a>
  </div>

    <!-- 新規登録フォーム -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header">新規ユーザー追加</div>
        <div class="card-body">
            <form method="post" class="row g-3">
                <!-- CSRFトークン -->
                <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">

                <div class="col-md-2">
                    <input class="form-control" name="login_id" placeholder="ログインID" required>
                </div>
                <div class="col-md-2">
                    <input class="form-control" name="name" placeholder="名前" required>
                </div>
                <div class="col-md-3">
                    <input class="form-control" name="mail" placeholder="メール">
                </div>
                <div class="col-md-2">
                    <input class="form-control" name="password" placeholder="パスワード" required>
                </div>
                <div class="col-md-1 form-check mt-2">
                    <input class="form-check-input" type="checkbox" name="admin_flag" value="1">
                    <label class="form-check-label">管理者</label>
                </div>
                <div class="col-md-1">
                    <button class="btn btn-primary w-100">追加</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ユーザー一覧 -->
    <div class="card shadow-sm">
        <div class="card-header">ユーザー一覧</div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-dark">
                <tr>
                    <th>ログインID</th>
                    <th>名前</th>
                    <th>メール</th>
                    <th>外部</th>
                    <th>パスワード</th>
                    <th>管理者</th>
                    <th>無効</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                {% for u in users %}
                <tr>
                    <form method="post">
                        <!-- CSRFトークン -->
                        <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
                        
                        <input type="hidden" name="login_id" value="{{ u.login_id }}">
                        <td>{{ u.login_id }}</td>
                        <td><input class="form-control form-control-sm" name="name" value="{{ u.name }}" {% if u.external %} disabled {% endif %}></td>
                        <td><input class="form-control form-control-sm" name="mail" value="{{ u.mail }}" {% if u.external %} disabled {% endif %}></td>
                        <td>{{ u.external }}</td>
                        <td>
                            {% if not u.external %}
                                <input class="form-control form-control-sm" name="password" placeholder="パスワード変更">
                            {% else %}
                                <input class="form-control form-control-sm" disabled placeholder="{{ u.external }}パスワード">
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <input type="checkbox" name="admin_flag" value="1" {% if u.admin_flag %}checked{% endif %}>
                        </td>
                        <td class="text-center">
                            <input type="checkbox" name="disabled_flag" value="1" {% if u.disabled_flag %}checked{% endif %}>
                        </td>
                        <td class="text-nowrap">
                            <button class="btn btn-sm btn-success">更新</button>
                            <a href="{{ url_for('admin.delete_user', user_id=u.id)}}" class="btn btn-sm btn-danger"
                               onclick="return confirm('削除しますか？')">削除</a>
                        </td>
                    </form>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

</body>
</html>
