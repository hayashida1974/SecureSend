<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Secure Send</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<style>
  body {
    background-color: #f5f6f8;
  }
  .clickable-row {
    cursor: pointer;
  }
  .clickable-row:hover {
    background-color: #08f9fa;
  }
</style>
</head>

<body>

<div class="container py-5">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <img
        src="{{ url_for('static', filename='img/app_logo.png') }}"
        alt="Secure Send"
        height="100">
    </div>

    <div class="d-flex gap-2">
      
      <!-- Back button -->
      <a href="{{ url_for('menu') }}"
        class="btn btn-outline-secondary d-flex align-items-center"
        aria-label="メニューに戻る">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <path d="M15 18l-6-6 6-6" />
        </svg>
        <span class="ms-1">戻る</span>
      </a>

      <!-- Side Menu button -->
      <button class="btn btn-outline-secondary" data-bs-toggle="offcanvas" data-bs-target="#sideMenu" aria-label="メニュー">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" y1="7" x2="20" y2="7"/>
          <line x1="4" y1="12" x2="20" y2="12"/>
          <line x1="4" y1="17" x2="20" y2="17"/>
        </svg>
      </button>

    </div>
  </div><!-- Header -->

  <!-- Side Menu -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="sideMenu">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">Secure Send</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>

    <div class="offcanvas-body">
      <div class="d-flex flex-column gap-2">

        <!-- ログアウトボタン -->
        <form method="get" action="{{ url_for('logout') }}">
          <button type="submit" class="btn btn-outline-danger w-100 text-start">
            ログアウト
          </button>
        </form>

      </div>
    </div>
  </div><!-- Side Menu -->

  <!-- List Card -->
  <div class="card shadow-sm">
    {% if upload_requests %}
      <div class="table-responsive">
        <table class="table table-hover table-striped align-middle mb-0">
          <thead class="table-light small text-muted">
            <tr>
              <th>BOX名</th>
              <th style="width: 120px">有効期限</th>
              <th style="width: 100px">状態</th>
              <th style="width: 110px">アップロード済<br/>ファイル数</th>
              <th style="width: 110px">ダウンロードURL<br/>発行数</th>
              <th style="width: 150px">作成日時</th>
            </tr>
          </thead>
          <tbody>
          {% for req in upload_requests %}
            <tr class="clickable-row"
                data-href="{{ url_for('upload_request_detail', upload_id=req.id) }}">
              <td class="fw-medium">
                {{ req.title or '（未設定）' }}
              </td>
              <td>
                {{ req.expires_at }}
              </td>
              <td>
                {% if req.is_expired == 1 %}
                  <span class="badge bg-danger">
                    期限切れ
                  </span>
                {% else %}
                  <span class="badge bg-success">
                    有効
                  </span>
                {% endif %}
              </td>
              <td>
                {{ req.file_count }}
              </td>
              <td>
                {{ req.download_url_count }}
              </td>
              <td>
                {{ req.created_at| datetime }}
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-center text-muted py-5">
        ファイルBOXはまだありません。
      </div>
    {% endif %}
  </div>

</div>

<script>
  document.querySelectorAll(".clickable-row").forEach(row => {
    row.addEventListener("click", () => {
      window.location = row.dataset.href;
    });
  });
</script>

</body>
</html>
